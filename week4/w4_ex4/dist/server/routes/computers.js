"use strict";
var express = require("express");
var computer = require("../model/computer");
var computersModel = require("../model/computers");
var computers = (function () {
    function computers() {
        this.computerList = new computersModel.computers([
            new computer.computer(1, 'In Search of Lost Time', 'Marcel Proust', 1913),
            new computer.computer(2, 'Ulysses', 'James Joyce', 1904),
            new computer.computer(3, 'Moby Dick', 'Herman Melville', 1851),
            new computer.computer(4, 'Nineteen Eighty Four', 'George Orwell', 1949)
        ]);
    }
    computers.routes = function () {
        var router = express.Router();
        var computersRoute = new computers();
        router.get('/computers/', computersRoute.index.bind(computersRoute));
        router.post('/computers/', computersRoute.create.bind(computersRoute));
        router.put('/computers/:computer_id', computersRoute.update.bind(computersRoute));
        router.delete('/computers/:computer_id', computersRoute.delete.bind(computersRoute));
        router.get('/computers/:computer', computersRoute.find.bind(computersRoute));
        router.post('/computers/delete/:computer_id', computersRoute.delete.bind(computersRoute));
        router.post('/computers/update/:computer_id', computersRoute.update.bind(computersRoute));
        return router;
    };
    computers.prototype.index = function (request, response) {
        response.json(this.computerList.list());
    };
    computers.prototype.create = function (request, response) {
        var computerTitle = request.body.computer_title;
        var computerAuthor = request.body.computer_author;
        var computerPublicationDate = request.body.computer_pdate;
        if (!computerTitle) {
            response.status(500).send('computer title not found');
            return;
        }
        if (!computerAuthor) {
            response.status(500).send('computer author not found');
            return;
        }
        if (!computerPublicationDate) {
            response.status(500).send('computer publication date not found');
            return;
        }
        response.json(this.computerList.add(computerTitle, computerAuthor, computerPublicationDate));
    };
    computers.prototype.update = function (request, response) {
        var computerId = parseInt(request.params.computer_id);
        var computer = this.computerList.fetch(computerId);
        var computerTitle = request.body.computer_title;
        var computerAuthor = request.body.computer_author;
        var computerPublicationDate = request.body.computer_pdate;
        if (!computer) {
            response.status(404).send('computer not found');
            return;
        }
        if (computerTitle !== undefined) {
            computer.setTitle(computerTitle);
        }
        if (computerAuthor !== undefined) {
            computer.setAuthor(computerAuthor);
        }
        if (computerPublicationDate !== undefined) {
            computer.setPublicationDate(computerPublicationDate);
        }
        response.json(computer);
    };
    computers.prototype.delete = function (request, response) {
        var computerId = parseInt(request.params.computer_id);
        var wasDeleted = this.computerList.delete(computerId);
        if (!wasDeleted) {
            response.status(404).send('computer not found');
            return;
        }
        else {
            response.json({ success: true });
        }
    };
    computers.prototype.find = function (request, response) {
        var computerQuery = request.params.computer;
        var computer = this.computerList.find(computerQuery);
        if (!computer) {
            response.status(404).send('computer not found');
            return;
        }
        response.json(computer);
    };
    return computers;
}());
exports.computers = computers;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUNYLENBQUM7UUFDRCxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBRTVCLENBQUM7SUFDTCxnQkFBQztBQUFELENBbEdBLEFBa0dDLElBQUE7QUFsR1ksOEJBQVMiLCJmaWxlIjoicm91dGVzL2NvbXB1dGVycy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgKiBhcyBjb21wdXRlciBmcm9tICcuLi9tb2RlbC9jb21wdXRlcic7XG5pbXBvcnQgKiBhcyBjb21wdXRlcnNNb2RlbCBmcm9tICcuLi9tb2RlbC9jb21wdXRlcnMnO1xuXG5leHBvcnQgY2xhc3MgY29tcHV0ZXJzIHtcbiAgICBwcml2YXRlIGNvbXB1dGVyTGlzdDogY29tcHV0ZXJzTW9kZWwuY29tcHV0ZXJzO1xuICAgIHB1YmxpYyBzdGF0aWMgcm91dGVzKCk6IGV4cHJlc3MuUm91dGVyIHtcbiAgICAgICAgbGV0IHJvdXRlcjogZXhwcmVzcy5Sb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuICAgICAgICBsZXQgY29tcHV0ZXJzUm91dGU6IGNvbXB1dGVycyA9IG5ldyBjb21wdXRlcnMoKTtcbiAgICAgICAgcm91dGVyLmdldCgnL2NvbXB1dGVycy8nLCBjb21wdXRlcnNSb3V0ZS5pbmRleC5iaW5kKGNvbXB1dGVyc1JvdXRlKSk7XG4gICAgICAgIHJvdXRlci5wb3N0KCcvY29tcHV0ZXJzLycsIGNvbXB1dGVyc1JvdXRlLmNyZWF0ZS5iaW5kKGNvbXB1dGVyc1JvdXRlKSk7XG4gICAgICAgIHJvdXRlci5wdXQoJy9jb21wdXRlcnMvOmNvbXB1dGVyX2lkJywgY29tcHV0ZXJzUm91dGUudXBkYXRlLmJpbmQoY29tcHV0ZXJzUm91dGUpKTtcbiAgICAgICAgcm91dGVyLmRlbGV0ZSgnL2NvbXB1dGVycy86Y29tcHV0ZXJfaWQnLCBjb21wdXRlcnNSb3V0ZS5kZWxldGUuYmluZChjb21wdXRlcnNSb3V0ZSkpO1xuICAgICAgICByb3V0ZXIuZ2V0KCcvY29tcHV0ZXJzLzpjb21wdXRlcicsIGNvbXB1dGVyc1JvdXRlLmZpbmQuYmluZChjb21wdXRlcnNSb3V0ZSkpO1xuICAgICAgICByb3V0ZXIucG9zdCgnL2NvbXB1dGVycy9kZWxldGUvOmNvbXB1dGVyX2lkJywgY29tcHV0ZXJzUm91dGUuZGVsZXRlLmJpbmQoY29tcHV0ZXJzUm91dGUpKTtcbiAgICAgICAgcm91dGVyLnBvc3QoJy9jb21wdXRlcnMvdXBkYXRlLzpjb21wdXRlcl9pZCcsIGNvbXB1dGVyc1JvdXRlLnVwZGF0ZS5iaW5kKGNvbXB1dGVyc1JvdXRlKSk7XG4gICAgICAgIHJldHVybiByb3V0ZXI7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuY29tcHV0ZXJMaXN0ID0gbmV3IGNvbXB1dGVyc01vZGVsLmNvbXB1dGVycyhbXG4gICAgICAgICAgICBuZXcgY29tcHV0ZXIuY29tcHV0ZXIoMSwgJ0luIFNlYXJjaCBvZiBMb3N0IFRpbWUnLCAnTWFyY2VsIFByb3VzdCcsIDE5MTMpLFxuICAgICAgICAgICAgbmV3IGNvbXB1dGVyLmNvbXB1dGVyKDIsICdVbHlzc2VzJywgJ0phbWVzIEpveWNlJywgMTkwNCksXG4gICAgICAgICAgICBuZXcgY29tcHV0ZXIuY29tcHV0ZXIoMywgJ01vYnkgRGljaycsICdIZXJtYW4gTWVsdmlsbGUnLCAxODUxKSxcbiAgICAgICAgICAgIG5ldyBjb21wdXRlci5jb21wdXRlcig0LCAnTmluZXRlZW4gRWlnaHR5IEZvdXInLCAnR2VvcmdlIE9yd2VsbCcsIDE5NDkpXG4gICAgICAgIF0pXG4gICAgfVxuXG4gICAgcHVibGljIGluZGV4KHJlcXVlc3Q6IGV4cHJlc3MuUmVxdWVzdCwgcmVzcG9uc2U6IGV4cHJlc3MuUmVzcG9uc2UpIHtcbiAgICAgICAgcmVzcG9uc2UuanNvbih0aGlzLmNvbXB1dGVyTGlzdC5saXN0KCkpO1xuICAgIH1cbiAgICBwdWJsaWMgY3JlYXRlKHJlcXVlc3Q6IGV4cHJlc3MuUmVxdWVzdCwgcmVzcG9uc2U6IGV4cHJlc3MuUmVzcG9uc2UpIHtcbiAgICAgICAgbGV0IGNvbXB1dGVyVGl0bGU6IHN0cmluZyA9IHJlcXVlc3QuYm9keS5jb21wdXRlcl90aXRsZTtcbiAgICAgICAgbGV0IGNvbXB1dGVyQXV0aG9yOiBzdHJpbmcgPSByZXF1ZXN0LmJvZHkuY29tcHV0ZXJfYXV0aG9yO1xuICAgICAgICBsZXQgY29tcHV0ZXJQdWJsaWNhdGlvbkRhdGU6IG51bWJlciA9IHJlcXVlc3QuYm9keS5jb21wdXRlcl9wZGF0ZTtcbiAgICAgICAgaWYgKCFjb21wdXRlclRpdGxlKSB7XG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMoNTAwKS5zZW5kKCdjb21wdXRlciB0aXRsZSBub3QgZm91bmQnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbXB1dGVyQXV0aG9yKSB7XG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMoNTAwKS5zZW5kKCdjb21wdXRlciBhdXRob3Igbm90IGZvdW5kJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb21wdXRlclB1YmxpY2F0aW9uRGF0ZSkge1xuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzKDUwMCkuc2VuZCgnY29tcHV0ZXIgcHVibGljYXRpb24gZGF0ZSBub3QgZm91bmQnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXNwb25zZS5qc29uKHRoaXMuY29tcHV0ZXJMaXN0LmFkZChjb21wdXRlclRpdGxlLCBjb21wdXRlckF1dGhvciwgY29tcHV0ZXJQdWJsaWNhdGlvbkRhdGUpKTtcbiAgICB9XG4gICAgcHVibGljIHVwZGF0ZShyZXF1ZXN0OiBleHByZXNzLlJlcXVlc3QsIHJlc3BvbnNlOiBleHByZXNzLlJlc3BvbnNlKVxuICAgIHtcbiAgICAgICAgbGV0IGNvbXB1dGVySWQ6IG51bWJlciA9IHBhcnNlSW50KHJlcXVlc3QucGFyYW1zLmNvbXB1dGVyX2lkKTtcbiAgICAgICAgbGV0IGNvbXB1dGVyOiBjb21wdXRlci5jb21wdXRlciA9IHRoaXMuY29tcHV0ZXJMaXN0LmZldGNoKGNvbXB1dGVySWQpO1xuICAgICAgICBsZXQgY29tcHV0ZXJUaXRsZTogc3RyaW5nID0gcmVxdWVzdC5ib2R5LmNvbXB1dGVyX3RpdGxlO1xuICAgICAgICBsZXQgY29tcHV0ZXJBdXRob3I6IHN0cmluZyA9IHJlcXVlc3QuYm9keS5jb21wdXRlcl9hdXRob3I7XG4gICAgICAgIGxldCBjb21wdXRlclB1YmxpY2F0aW9uRGF0ZTogbnVtYmVyID0gcmVxdWVzdC5ib2R5LmNvbXB1dGVyX3BkYXRlO1xuXG4gICAgICAgIGlmICghY29tcHV0ZXIpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyg0MDQpLnNlbmQoJ2NvbXB1dGVyIG5vdCBmb3VuZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoY29tcHV0ZXJUaXRsZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICB7XG4gICAgICAgICAgY29tcHV0ZXIuc2V0VGl0bGUoY29tcHV0ZXJUaXRsZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY29tcHV0ZXJBdXRob3IgIT09IHVuZGVmaW5lZClcbiAgICAgICAge1xuICAgICAgICAgIGNvbXB1dGVyLnNldEF1dGhvcihjb21wdXRlckF1dGhvcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY29tcHV0ZXJQdWJsaWNhdGlvbkRhdGUgIT09IHVuZGVmaW5lZClcbiAgICAgICAge1xuICAgICAgICAgIGNvbXB1dGVyLnNldFB1YmxpY2F0aW9uRGF0ZShjb21wdXRlclB1YmxpY2F0aW9uRGF0ZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXNwb25zZS5qc29uKGNvbXB1dGVyKTtcbiAgICB9XG4gICAgcHVibGljIGRlbGV0ZShyZXF1ZXN0OiBleHByZXNzLlJlcXVlc3QsIHJlc3BvbnNlOiBleHByZXNzLlJlc3BvbnNlKSB7XG4gICAgICAgIGxldCBjb21wdXRlcklkOiBudW1iZXIgPSBwYXJzZUludChyZXF1ZXN0LnBhcmFtcy5jb21wdXRlcl9pZCk7XG4gICAgICAgIGxldCB3YXNEZWxldGVkOiBCb29sZWFuID0gdGhpcy5jb21wdXRlckxpc3QuZGVsZXRlKGNvbXB1dGVySWQpO1xuXG4gICAgICAgIGlmICghd2FzRGVsZXRlZCkge1xuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzKDQwNCkuc2VuZCgnY29tcHV0ZXIgbm90IGZvdW5kJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICB7XG4gICAgICAgICAgcmVzcG9uc2UuanNvbih7c3VjY2VzczogdHJ1ZX0pO1xuICAgICAgICB9XG5cbiAgICB9XG4gICAgcHVibGljIGZpbmQocmVxdWVzdDogZXhwcmVzcy5SZXF1ZXN0LCByZXNwb25zZTogZXhwcmVzcy5SZXNwb25zZSkge1xuICAgICAgICBsZXQgY29tcHV0ZXJRdWVyeTogc3RyaW5nID0gcmVxdWVzdC5wYXJhbXMuY29tcHV0ZXI7XG4gICAgICAgIGxldCBjb21wdXRlcjogY29tcHV0ZXIuY29tcHV0ZXIgPSB0aGlzLmNvbXB1dGVyTGlzdC5maW5kKGNvbXB1dGVyUXVlcnkpO1xuXG4gICAgICAgIGlmICghY29tcHV0ZXIpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyg0MDQpLnNlbmQoJ2NvbXB1dGVyIG5vdCBmb3VuZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJlc3BvbnNlLmpzb24oY29tcHV0ZXIpO1xuXG4gICAgfVxufVxuIl19
